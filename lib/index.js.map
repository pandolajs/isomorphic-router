{"version":3,"sources":["webpack:///webpack/bootstrap e2d814987e419ecb5af1","webpack:///./src/index.js","webpack:///external \"universal-router\"","webpack:///external \"lodash/isFunction\"","webpack:///external \"lodash/pick\""],"names":["DEFAULT","baseUrl","catchError","IsomorphicRouter","requireContext","options","middlewares","context","next","opts","Object","assign","filteredPath","exclude","keys","filter","mod","test","verifyUniversalRoute","route","routeKeyStr","join","Error","children","map","default","middleware","push","callback","routes","path","action","composed","reduce","cur","Promise","resolve","error","reject","router","errorHandler"],"mappings":"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","file":"index.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap e2d814987e419ecb5af1","/**\n * Copyright (c) 2009-present sizhao-pandolajs, All rights reserved.\n * @fileoverview 基于 universal-router 的同构路由\n * @author sizhao | 870301137@qq.com\n * @version 1.0 | 2018-01-17 | sizhao       // 初始版本\n * @version 2.0 | 2018-03-05 | sizhao       // 1. 适配 UniversalRouter 6.0, 使用新增配置 `errorHandler` 作为 404 及错误处理\n *                                          // 2. 删除 notFound 配置项，使用 catch 统一配置\n *                                          // 3. catch 回调入参为 { code, context } 格式\n */\n\nimport UniversalRouter from 'universal-router'\nimport isFunction from 'lodash/isFunction'\nimport pick from 'lodash/pick'\n\nconst DEFAULT = {\n  baseUrl: '/',\n  catchError: () => {}\n}\n\n/**\n * https://github.com/webpack/docs/wiki/context\n * @param requireContext {Function}         // webpack require.context 返回的函数，接收模块路径\n *   @param requireContext.keys {Function}\n *   @param requireContext.resolve {Function}\n *   @param requireContext.id {String}\n * @param options {Object}\n *   @param option.baseUrl {String}\n *   @param option.context {Object}\n *   @param option.resolveRoute {Function}\n *   @param option.exclude {RegExp}\n*/\nclass IsomorphicRouter {\n  constructor(requireContext, options){\n    this.middlewares = [\n      async (context, next) => {\n        return await next()\n      }\n    ]\n    const opts = this.options = Object.assign({}, DEFAULT, options)\n    this.catchError = DEFAULT.catchError\n    let filteredPath = []\n\n    const { exclude } = opts\n\n    filteredPath = requireContext.keys().filter((mod) => {\n      return exclude ? !exclude.test(mod) : true\n    })\n\n    function verifyUniversalRoute(route){\n      const routeKeyStr = Object.keys(route).join(',')\n      if(!/(?:path|action|children)/i.test(routeKeyStr)){\n        throw new Error(`${mod} MUST export a valid universal route`)\n      }\n      return route\n    }\n\n    const children = filteredPath.map((mod) => {\n      // route MUST be a valid Universal Route\n      // {path, action, children? }\n      let route = requireContext(mod).default\n      return verifyUniversalRoute(route)\n    })\n\n    this.children = children\n  }\n\n  use(middleware){\n    isFunction(middleware) && this.middlewares.push(middleware)\n    return this\n  }\n\n  catch(callback){\n    this.catchError = callback\n    return this\n  }\n\n  router(){\n    const { middlewares, catchError } = this\n    const routes = {\n      path: '/',\n      children: this.children,\n      async action(context){\n        let route\n        let { next } = context\n\n        const composed = middlewares.reduce((next, cur) => context => {\n          try{\n            return Promise.resolve(cur(context, next))\n          }catch(error){\n            return Promise.reject(error)\n          }\n        }, next)\n\n        route = await composed(context)\n\n        return route\n      }\n    }\n    const router = new UniversalRouter(routes, Object.assign({}, pick(this.options, ['baseUrl', 'context', 'resolveRoute']), { errorHandler: catchError }))\n    return router\n  }\n}\n\nexport default IsomorphicRouter\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","module.exports = require(\"universal-router\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"universal-router\"\n// module id = 1\n// module chunks = 0","module.exports = require(\"lodash/isFunction\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/isFunction\"\n// module id = 2\n// module chunks = 0","module.exports = require(\"lodash/pick\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/pick\"\n// module id = 3\n// module chunks = 0"],"sourceRoot":""}